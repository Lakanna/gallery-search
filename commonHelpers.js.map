{"version":3,"file":"commonHelpers.js","sources":["../src/js/render-functions.js","../src/js/pixabay-api.js","../src/main.js"],"sourcesContent":["function createMarkup(arr) {\n  return arr\n    .map(\n      ({\n        comments,\n        likes,\n        downloads,\n        views,\n        largeImageURL,\n        webformatURL,\n        tags,\n      }) => {\n        return `\n        <li class=\"gallery-item\">\n          <a href=\"${largeImageURL}\" class=\"img-container\">\n             <img src=\"${webformatURL}\" alt=\"${tags}\" />\n          </a>\n          <ul class=\"tags-list\">\n               <li class=\"tags-item\">Comments:<span class=\"tags-item-span\"> ${comments}</span></li>\n               <li class=\"tags-item\">Likes:<span class=\"tags-item-span\"> ${likes}</span></li>\n               <li class=\"tags-item\">Views:<span class=\"tags-item-span\"> ${views}</span> </li>\n               <li class=\"tags-item\">Downloads:<span class=\"tags-item-span\"> ${downloads}</span></li>\n          </ul>\n        </li>`;\n      }\n    )\n    .join('');\n}\n\nexport default createMarkup;\n","const API_KEY = '40437222-3b8e1aead0ae08f3118e12752';\nconst API = 'https://pixabay.com/api/';\n\nasync function fetchImg(searchedImg = '', page = 1, per_page = 20) {\n  const params = new URLSearchParams({\n    key: API_KEY,\n    q: searchedImg,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: 'true',\n    page,\n    per_page,\n  });\n\n  // let url = `${API}?${params}`;\n  // const response = await axios.get(API, { params });\n  // return response.data;\n\n  return fetch(`${API}?${params}`).then(resp => {\n    if (!resp.ok) {\n      throw new Error(resp.statusText);\n    }\n    // console.log(resp.json());\n    return resp.json();\n  });\n}\n\nexport { fetchImg };\n","import createMarkup from './js/render-functions';\nimport { fetchImg } from './js/pixabay-api';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst elements = {\n  searchForm: document.querySelector('.js-form'),\n  imageList: document.querySelector('.js-list'),\n  loader: document.querySelector('.loader'),\n  // btnLoadMore: document.querySelector('.js-btn-load-more'),\n  guadr: document.querySelector('.js-guard'),\n  btnToTop: document.getElementById('back - to - up'),\n};\n\nconsole.log(elements.btnToTop);\n/*\nстворити обʼєкт параметрів вказавши всі параметри, які ми будемо передавати під час запиту\n\n! Submit\n1. повісити обробник події на сабміт форми\n  1.1. перевент дефолт\n  1.2. очистити всю сторінку від результатів попереднього запиту. Також зкидуємо номер сторінки в параметрах запиту на 1 (page = 1)\n  1.3. збираємо запит користувача (з поля вводу)\n  1.4. перевіряємо чи користувач взагалі щось ввів (перевірка на пустий рядок з використанням тріму)\n  1.5. вмикаємо прелоадер на кнопці (блокуючи натискання на неї) та викликаємо фукнцію запиту (описана окремо)\n  1.6. отримуємо дані з серверу та малюємо їх на сторінці\n  1.7. розблоковуємо кнопку завантажити більше та прибираємо прелоадер\n\n! Load more\nСтани кнопки\n\n1. hidden - стан, коли кнопки взагалі немає на сторінці. В ситуаціях: до запиту, коли немає новин, коли кінець колекції (при полмилці)\n2. active - стан, коли кнопка активна до нового натискання та запиту. В ситуаціяї коли користувач може підвантажити нові дані з серверу.\n3. disabled - стан, коли йде запит і кнопка повинна бути не активною для натискання, також вона повинна відображати прелоадер. В ситуаціяї, коли користувач натискає на кнопку та чекає відповіді від серверу.\n\nпри натисканні на кнопку повинен йти запит на сервер з вказанням сторінки +1\n\n*/\n\n// const params = {\n//   q: '',\n//   page: 1,\n//   per_page: 15,\n//   maxPage: 1,\n// };\n\n// elements.searchForm.addEventListener('submit', handlerSearch);\n\n// function handlerSearch(evn) {\n//   evn.preventDefault();\n//   elements.imageList.innerHTML = '';\n\n//   params.q = evn.currentTarget.elements.searchImg.value.trim();\n\n//   if (params.q === '') {\n//     iziToast.show({\n//       message: 'Please, input what are you searching!',\n//       color: 'red',\n//       position: 'topCenter',\n//     });\n//     return;\n//   }\n\n//   elements.loader.hidden = false;\n\n//   fetchImg(params.q, params.page, params.per_page)\n//     .then(({ totalHits, hits }) => {\n//       if (hits.length === 0) {\n//         iziToast.show({\n//           message:\n//             'Sorry, there are no images matching your search query. Please try again!',\n//           color: 'red',\n//           position: 'topCenter',\n//         });\n//       }\n\n//       elements.imageList.insertAdjacentHTML('beforeend', createMarkup(hits));\n//       let gallery = new SimpleLightbox('.image-list a');\n\n//       params.maxPage = Math.ceil(totalHits / params.per_page);\n//       console.log(params.maxPage);\n//       gallery.refresh();\n\n//       if (params.maxPage > params.page) {\n//         elements.btnLoadMore.classList.remove('is-hidden');\n//         elements.btnLoadMore.addEventListener('click', handlerLoadMore);\n//       }\n//     })\n//     .catch(handleError)\n//     .finally(() => {\n//       elements.loader.hidden = true;\n//       evn.target.reset();\n//     });\n// }\n\n// function handleError(err) {\n//   iziToast.show({\n//     message: 'Sorry, sometings going wrong. Please try again!',\n//     color: 'red',\n//     position: 'topCenter',\n//   });\n//   console.log(err);\n// }\n\n// function handlerLoadMore() {\n//   elements.btnLoadMore.disabled = true;\n//   params.page += 1;\n//   console.log(params.page, params.maxPage);\n\n//   fetchImg(params.q, params.page, params.per_page).then(({ hits }) => {\n//     elements.imageList.insertAdjacentHTML('beforeend', createMarkup(hits));\n//     let gallery = new SimpleLightbox('.image-list a');\n\n//     if (params.maxPage > params.page) {\n//       elements.btnLoadMore.disabled = false;\n//     }\n//     if (params.maxPage === params.page) {\n//       elements.btnLoadMore.classList.add('is-hidden');\n//       console.log('in if maxPage=page');\n//     }\n//   });\n// }\n\n/**\n * !intersection observer\n */\n\nconst params = {\n  q: '',\n  page: 1,\n  per_page: 15,\n  maxPage: 1,\n};\n\nconst options = {\n  root: null,\n  rootMargin: '300px',\n};\n\nlet observer = new IntersectionObserver(handleLoadMore, options);\n\nelements.searchForm.addEventListener('submit', handlerSearch);\n\nfunction handlerSearch(evn) {\n  evn.preventDefault();\n  elements.imageList.innerHTML = '';\n\n  params.q = evn.currentTarget.elements.searchImg.value.trim();\n\n  if (params.q === '') {\n    iziToast.show({\n      message: 'Please, input what are you searching!',\n      color: 'red',\n      position: 'topCenter',\n    });\n    return;\n  }\n\n  elements.loader.hidden = false;\n\n  fetchImg(params.q, params.page, params.per_page)\n    .then(({ totalHits, hits }) => {\n      if (hits.length === 0) {\n        iziToast.show({\n          message:\n            'Sorry, there are no images matching your search query. Please try again!',\n          color: 'red',\n          position: 'topCenter',\n        });\n      }\n\n      elements.imageList.insertAdjacentHTML('beforeend', createMarkup(hits));\n      let gallery = new SimpleLightbox('.image-list a');\n\n      params.maxPage = Math.ceil(totalHits / params.per_page);\n      console.log(params.maxPage);\n      gallery.refresh();\n\n      if (params.maxPage > params.page) {\n        observer.observe(elements.guadr);\n      }\n    })\n    .catch(handleError)\n    .finally(() => {\n      elements.loader.hidden = true;\n      evn.target.reset();\n    });\n}\n\nfunction handleError(err) {\n  iziToast.show({\n    message: 'Sorry, sometings going wrong. Please try again!',\n    color: 'red',\n    position: 'topCenter',\n  });\n  console.log(err);\n}\n\nfunction handleLoadMore(entries, observer) {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      params.page += 1;\n\n      fetchImg(params.q, params.page, params.per_page)\n        .then(({ hits }) => {\n          elements.imageList.insertAdjacentHTML(\n            'beforeend',\n            createMarkup(hits)\n          );\n          let gallery = new SimpleLightbox('.image-list a');\n\n          if (params.page >= params.maxPage) {\n            observer.unobserve(elements.guadr);\n            console.log('in if maxPage=page');\n          }\n        })\n        .catch(handleError)\n        .finally(() => {\n          elements.loader.hidden = true;\n        });\n    }\n  });\n}\n// elements.btnToTop.addEventListener('click', scrollToTop);\n// if (!elements.btnToTop.classList.contains('d-none')) {\n\n// }\n\nwindow.onscroll = () => {\n  toggleTopButton();\n};\n\nfunction scrollToTop() {\n  window.scrollBy({\n    top: heightOfElment * 2,\n    behavior: 'smooth',\n  });\n}\n\nfunction toggleTopButton() {\n  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {\n    document.getElementById('back-to-up').classList.remove('d-none');\n    document\n      .getElementById('back-to-up')\n      .addEventListener('click', scrollToTop);\n  } else {\n    document.getElementById('back-to-up').classList.add('d-none');\n  }\n}\n\n// const promis = new Promise((resolve, reject) => {\n//   if (1 > 2) {\n//     resolve('On resolve');\n//   } else {\n//     reject('In error');\n//   }\n// });\n\n// promis\n//   .then(value => {\n//     console.log(value);\n//   })\n//   .catch(error => {\n//     console.log(error);\n//   })\n//   .finally(() => {\n//     console.log('after all');\n//   });\n"],"names":["createMarkup","arr","comments","likes","downloads","views","largeImageURL","webformatURL","tags","API_KEY","API","fetchImg","searchedImg","page","per_page","params","resp","elements","options","observer","handleLoadMore","handlerSearch","evn","iziToast","totalHits","hits","gallery","SimpleLightbox","handleError","err","entries","entry","toggleTopButton","scrollToTop"],"mappings":"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"}